\documentclass[a4paper]{article}
\usepackage[utf8]{inputenc}
\usepackage{amsmath}
\usepackage{amssymb}

\usepackage[english]{babel}
 \newtheorem{theorem}{Theorem}[section]
\newtheorem{corollary}{Corollary}[theorem]
\newtheorem{lemma}[theorem]{Lemma}
\title{European Options}

\date{}
\author{M Sidik Augi Rahmat}
\begin{document}
\maketitle
\section{Pricing Plain Vanilla Call and Put Options}
With regard to the Black-Scholes model for pricing derivative securies, the partial differential equation describing the evolution of the price of an
an option written on a stock paying continous dividengs has the following form
\begin{equation}
    \begin{aligned}
    \frac{\partial V}{\partial t}+\frac{1}{2} \sigma^{2} S^{2} & \frac{\partial^{2} V}{\partial S^{2}}+(r-q) S \frac{\partial V}{\partial S}-r V =0 \\
    V(S, T)=\bar{V}(S), & S>0, t \in[0, T]
    \end{aligned}
    \label{eq:1}
\end{equation}
The meaning of respective variables is the following $V = V(S, t)$ is the price of a European option written on the underlying asset having $S>0$ its present 
spot price at a time $t \in [0, T]$ and $T>0$ is the expiration time of the option. The remaining model parameters are $\sigma > 0$ is volatily of the stock, 
i.e, the standard deviation of the estochastic time evolution of the underlying asset, $r > 0$ is an interest rate continuosly compounded riskless zero coupon bond and $q$ is continous annualized dividend
yield paid by the stock. \par 
Finally, we recall that, in the case of Europena call option, the terminal condition $\bar{V}(S)= V(S,T)$ at the expiration time is given by the function
\begin{equation}
    \bar{V}(S)=(S-E)^{+}=\left\{\begin{array}{ll}
    {S-E,} & {\text { for } S \geq E} \\
    {0,} & {\text { for } 0<S<E}
    \end{array}\right.
\end{equation}
where $E$ is the expiration (strike) price at which the option contract is signed. in the case of a put option, the terminal condition teads as follows:
\begin{equation}
    \bar{V}(S)=(E-S)^{+}=\left\{\begin{array}{ll}
    {E-S,} & {\text { for } 0<S \leq E} \\
    {0,} & {\text { for } E<S}
    \end{array}\right.
\end{equation}
The main idea of construction of an explicit solution to equation $\ref{eq:1}$ with given terminal condition consists in sequence of transformations of this 
equation into basic form of parabolic equation
\begin{equation}
    \frac{\partial u}{\partial t}-a^{2} \frac{\partial^{2} u}{\partial x^{2}}=0, \quad(x, t) \in(-\infty, \infty) \times[0, T]
\end{equation}
with the prescribed the initial condition.
\par 
\begin{itemize}
    \item[1] Transformation of time. We transform the time $t \in [0, T]$ such that it flows just in opposite direction, i.e., from the expiration time $T$ to the initial time $t=0$. To this end, we introduce
a new variable $\tau = T -t$ and set
\begin{equation}
    W(S, \tau)=V(S, T-\tau), \quad \text { and so } \quad V(S, t)=W(S, T-t)
\end{equation}
Using the relation $dt = -d\tau $ equation (\ref{eq:1}) is transformed into:
\begin{equation}
    \begin{aligned}
    \frac{\partial W}{\partial \tau} &-\frac{1}{2} \sigma^{2} S^{2} \frac{\partial^{2} W}{\partial S^{2}}-(r-q) S \frac{\partial W}{\partial S}+r W=0 \\
    W(S, 0) &=\bar{V}(S), \quad S>0, \tau \in[0, T]
    \end{aligned}
    \label{eq:2}
\end{equation}
    \item[2] The logarithmic transformations of the underling stock price. It consist in the substitution $S = e^x$, $x = ln S$ and introducing a new function
    \begin{equation}
        Z(x, \tau)=W\left(e^{x}, \tau\right), \quad \text { and so } W(S, \tau)=Z(\ln S, \tau)
    \end{equation}
Notice that $S \in (0, \infty)$ if and only if $x \in (-\infty, \infty)$. Using the chain rule for the differentiation we obtain
\begin{equation}
    \frac{\partial Z}{\partial x}=S \frac{\partial W}{\partial S}, \quad \frac{\partial^{2} Z}{\partial x^{2}}=S^{2} \frac{\partial^{2} W}{\partial S^{2}}+S \frac{\partial W}{\partial S}=S^{2} \frac{\partial^{2} W}{\partial S^{2}}+\frac{\partial Z}{\partial x}
\end{equation}
Equation (\ref{eq:2}) can be then rewritten in the form :
\begin{equation}
    \begin{array}{l}
    {\frac{\partial Z}{\partial \tau}-\frac{1}{2} \sigma^{2} \frac{\partial^{2} Z}{\partial x^{2}}+\left(\frac{\sigma^{2}}{2}-r+q\right) \frac{\partial Z}{\partial x}+r Z=0} \\
    {Z(x, 0)=\bar{V}\left(e^{x}\right), \quad-\infty<x<\infty, \tau \in[0, T]}
    \end{array}
\end{equation}
    \item[3] Transformations into the basic parabolic partial differential equation. Terms containing the lower order derivatives $Z$ and $\frac{\partial Z}{\partial x}$ can be eliminated by an exponentail 
transformations 
\begin{equation}
    u(x, \tau)=e^{\alpha x+\beta \tau} Z(x, \tau), \quad \text { i.e. } \quad Z(x, \tau)=e^{-\alpha x-\beta \tau} u(x, \tau)
\end{equation}
where constants $\alpha$, $\beta$ will be specified later. We obtain 
\begin{equation}
    \begin{aligned}
    \frac{\partial Z}{\partial x} &=e^{-\alpha x-\beta \tau}\left(\frac{\partial u}{\partial x}-\alpha u\right) \\
    \frac{\partial^{2} Z}{\partial x^{2}} &=e^{-\alpha x-\beta \tau}\left(\frac{\partial^{2} u}{\partial x^{2}}-2 \alpha \frac{\partial u}{\partial x}+\alpha^{2} u\right) \\
    \frac{\partial Z}{\partial \tau} &=e^{-\alpha x-\beta \tau}\left(\frac{\partial u}{\partial \tau}-\beta u\right)
    \end{aligned}
\end{equation}
For the new tra function $u$ we may therefore conclude that it is a solution to the partial differential equation
\begin{equation}
    \begin{aligned}
    \frac{\partial u}{\partial \tau}-& \frac{\sigma^{2}}{2} \frac{\partial^{2} u}{\partial x^{2}}+A \frac{\partial u}{\partial x}+B u=0 \\
    u(x, 0) &=e^{\alpha x \bar{V}\left(e^{x}\right)}
    \end{aligned}
\end{equation}
For the new transformed function $u$ we may therefore conclude that it is a solution to the partial differential equation
\begin{equation}
    \begin{aligned}
    \frac{\partial u}{\partial \tau}-& \frac{\sigma^{2}}{2} \frac{\partial^{2} u}{\partial x^{2}}+A \frac{\partial u}{\partial x}+B u=0 \\
    u(x, 0) &=e^{\alpha x \bar{V}\left(e^{x}\right)}
    \end{aligned}
\end{equation}
where the coefficients $A, B$ satisfy 
\begin{equation}
    A=\alpha \sigma^{2}+\frac{\sigma^{2}}{2}-r+q, \quad \text { a } B=(1+\alpha) r-\beta-\alpha q-\frac{\alpha^{2} \sigma^{2}+\alpha \sigma^{2}}{2}
\end{equation}
By simple algebraic computation, we find that constants $\alpha, \beta$ can be chosen in such way that the terms $A, B$ are vanishing. Indeed
\begin{equation}
    \alpha=\frac{r-q}{\sigma^{2}}-\frac{1}{2}, \quad \beta=\frac{r+q}{2}+\frac{\sigma^{2}}{8}+\frac{(r-q)^{2}}{2 \sigma^{2}}
    \label{eq:koef}
\end{equation}
With this choice of coefficients $\alpha, \beta$ the resulting equation for the function $u$ has the form
\begin{align}
    \frac{\partial u}{\partial \tau}-\frac{\sigma^{2}}{2} \frac{\partial^{2} u}{\partial x^{2}}=0 \\
    u(x, 0)=e^{\alpha x} \bar{V}\left(e^{x}\right), \quad-\infty<x<\infty, \tau \in[0, T]
    \label{eq:3}
\end{align}
    \item[4] Applying the Green formula for a solution to the heat equation. The explicit solution for equation (\ref{eq:3}) has the form of an integral:
    \begin{equation}
        u(x, \tau)=\frac{1}{\sqrt{2 \sigma^{2} \pi \tau}} \int_{-\infty}^{\infty} e^{-\frac{(x-s)^{2}}{2 \sigma^{2} \tau}} u(s, 0) d s
    \end{equation}
Now, by a sequence of backward substituions $u \mapsto Z \mapsto W \mapsto V$, we finally obtain:
    \begin{equation}
        V(S, T-\tau)=e^{-\beta \tau} e^{-\alpha \ln S} u(\ln S, \tau)
    \end{equation}
and hence
    \begin{equation}
        V(S, T-\tau)=\frac{e^{-\beta \tau}}{\sqrt{2 \sigma^{2} \pi \tau}} S^{-\alpha} \int_{-\infty}^{\infty} e^{-\frac{(\ln S-s)^{2}}{2 \sigma^{2} \tau}} e^{\alpha s} \bar{V}\left(e^{s}\right) d s
    \end{equation}
For thee European call option we have $\bar{V}(S)=(S-E)^{+}$ and so the realtion can be further simplified as follows :
    \begin{equation}
        V(S, T-\tau)=\frac{e^{-\beta \tau}}{\sqrt{2 \sigma^{2} \pi \tau}} S^{-\alpha} \int_{ln E}^{\infty} e^{-\frac{(\ln S-s)^{2}}{2 \sigma^{2} \tau}} e^{\alpha s} \left(e^{s}- E\right) d s
    \end{equation}
The substituions $y=s-lnS$ leads to :
    \begin{equation}
        V(S, T-\tau)=\frac{e^{-\beta \tau}}{\sqrt{2 \sigma^{2} \pi \tau}} S^{-\alpha} \int_{-ln \frac{S}{E}}^{\infty} e^{-\frac{(y)^{2}}{2 \sigma^{2} \tau}}  \left(Se^{(1+\alpha)y}- E e^{\alpha y}\right) d s
    \end{equation}
A practical computation using above formula requires rewritting the price $V$ into a form containing elementary or special functions. Recall that the cumulative distribution function $N(X)$ 
and the error function $erf(x)$ of the normal distribution are defined by means of the Euler integral as follows:
\begin{equation}
    N(x) = \frac{1}{\sqrt{2 \pi}} \int_{\infty}^{x} e^{-\frac{\xi^2}{2}d\xi}, \quad \frac{1-erf(x)}{2} = \frac{1}{\pi} \int_{x}^{\infty} e^{\xi^2} d\xi
\end{equation}
The following identities are useful:
\begin{equation}
    erf(-x) = -erf(x) \quad \frac{1}{2} \bigg(1 + erf \bigg( \frac{x}{\sqrt{2}} \bigg)\bigg) = \frac{1}{\sqrt{2}} \int_{\infty}^{x} e^{-\xi^2/2} d\xi = N(x)
\end{equation}
for each $x \in \mathbb{R}$.
Let us consider the integral
\begin{equation}
    I_1 = \frac{e^{\beta \tau}}{\sqrt{2\sigma^2 \tau}} \frac{1}{\sqrt{\pi}} \int_{-ln\frac{S}{E}}^{\infty} e^{ -\frac{y^2}{2\sigma^2 \tau} + (1 + \alpha)y}dy
\end{equation}
By introducing another substitution $\xi = \frac{y}{\sqrt{2\sigma^2 \tau}} - \frac{1 + \alpha}{2} \sqrt{2\sigma^2 \tau}$ and using realtion (\ref{eq:koef}) we obtain
\begin{equation}
    - \frac{y^2}{2\sigma^2 \tau} + (1 + \alpha)y = -xi^2 + (1 + \alpha)^2 \frac{\sigma^2 \tau }{2} = -\xi^2 + (\beta - q) \tau
\end{equation}
Hence 
\begin{align}
    I_1 &= e^{-q \tau } \frac{1}{\sqrt{\pi}} \int_{-\frac{1+\alpha}{2} \sqrt{2\sigma^2 \tau}- \frac{ln \frac{S}{E}}{\sqrt{2*\sigma^2 \tau}}}^{\infty} e^{-xi^2} d\xi\\
        &= e^{-q \tau }/2 \bigg[ 1 - erf \bigg(-\frac{1 + \alpha }{2} \sqrt{2 \sigma^2 \tau} - \frac{ln \frac{S}{E}}{\sqrt{2 \sigma^2 \tau}} \bigg) \bigg]\\
        &= e^{-q \tau }/2 \bigg[ 1 + erf \bigg( \frac{1}{\sqrt{2}} \frac{(r - q + \frac{\sigma^2}{2}) \tau + ln \frac{S}{E}}{\sigma \sqrt{\tau}}\bigg)\bigg]\\
\end{align}

By introducing another substituion $\xi = \frac{y}{\sqrt{2\sigma^2 \tau}} - \frac{\alpha}{\sigma{2\sigma^2 \tau}}$ we can compute the integral
\begin{equation}
    I_2 = \frac{e^{-r \tau}}{2} \bigg[ 1 + erf \bigg( \frac{1}{\sqrt{2}} \frac{(r-q-\frac{\sigma^2}{2})\tau + ln\frac{S}{E}}{\sigma \sqrt{\tau}}\bigg) \bigg]
\end{equation}
Substituting above results for the integrals $I_1$ and $I_2$ we can finally get the formula for the \textbf{Call European Options} $V(S, 0)$:
\begin{align}
    V(S, T-\tau) &= \frac{Se^{-q\tau}}{2} \bigg[ 1 + erf \bigg( \frac{1}{\sqrt{2}} \frac{1}{\sqrt{2}} \frac{(r - q + \frac{\sigma^2}{2}) \tau + ln \frac{S}{E}}{\sigma \sqrt{\tau}} \bigg) \bigg]\\
                &- \frac{E e^{-r \tau}}{2} \bigg[ 1 + erf \bigg( \frac{1}{\sqrt{2}} \frac{1}{\sqrt{2}} \frac{(r - q - \frac{\sigma^2}{2}) \tau + ln \frac{S}{E}}{\sigma \sqrt{\tau}} \bigg) \bigg]
\end{align}
Using the relations between functions $N(x)$ and $erf(x)$ we finally conclude
\begin{equation}
    V(S,t) = S e^{-q(T-t)} N(d_1) - E e^{-r(T-t)} N(d_2)
    \label{eq:BSE-European}
\end{equation}
where
\begin{equation}
    d_1 = \frac{(r - q + \frac{\sigma^2}{2}) (T - t) + ln \frac{S}{E}}{\sigma \sqrt{T-t}}, \quad d_2 = d_1 - \sigma\sqrt{T-t}
\end{equation}
Expression (\ref{eq:BSE-European}) is called the Black-Scholers formula for prcing European call options.
\end{itemize}
\end{document}